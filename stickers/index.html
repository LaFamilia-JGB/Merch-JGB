<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>La Familia - JGB - הזמנת מדבקות</title>
</head>
<body>
    <h1>הזמנת מדבקות</h1>
    <p>מלאו את הטופס להזמנה</p>

    <form action="https://script.google.com/macros/s/AKfycbyzqKnfmGPh2W20DrVTsO3JdQZ2BOJQA76qN4fNxbE5EPky8DcWix41zLYibcxZmyCx/exec" method="POST" onsubmit="return validateForm()">
        <label>שם מלא:</label><br>
        <input type="text" name="full-name" required><br>

        <label>כמות מדבקות:</label><br>
        <input type="number" name="sticker-quantity" required><br>

        <label>כמה שולם בפייבוקס:</label><br>
        <input type="number" name="paybox-amount" step="0.01" required><br>

        <label>משלוח/איסוף:</label><br>
        <select name="shipping-pickup" id="shipping-pickup" onchange="toggleAddressFields()" required>
            <option value="" selected>בחר</option>
            <option value="איסוף">איסוף</option>
            <option value="משלוח">משלוח</option>
        </select><br>

        <div id="address-fields" style="display: none;">
            <label>עיר:</label><br>
            <input type="text" id="city"><br>

            <label>רחוב:</label><br>
            <input type="text" id="street"><br>

            <label>מספר דירה:</label><br>
            <input type="number" id="apartment-number"><br>

            <label>מיקוד:</label><br>
            <input type="text" id="zip-code"><br>
        </div>

        <input type="hidden" name="shipping-address" id="shipping-address">

        <label>שולם על ידי:</label><br>
        <input type="text" name="paid-by" required><br>

        <label>טלפון:</label><br>
        <input type="tel" name="phone" required><br>

        <label>הערות:</label><br>
        <textarea name="notes"></textarea><br>

        <input type="submit" value="שלח הזמנה">
    </form>

    <h2>אפשרויות תשלום</h2>
    <p>לאחר שליחת ההזמנה, בחרו אחת מהאפשרויות הבאות לתשלום:</p>
    <ul>
        <li><a href="[BIT_PAYMENT_LINK]" target="_blank">תשלום ב-Bit</a></li>
        <li><a href="[PAYBOX_PAYMENT_LINK]" target="_blank">תשלום ב-Paybox</a></li>
    </ul>
    <p><a href="../shirts/">להזמנת חולצות</a></p>

    <script>
        function toggleAddressFields() {
            var select = document.getElementById("shipping-pickup");
            var addressFields = document.getElementById("address-fields");
            if (select.value === "משלוח") {
                addressFields.style.display = "block";
            } else {
                addressFields.style.display = "none";
            }
        }

        function combineAddress() {
            var select = document.getElementById("shipping-pickup");
            var hiddenAddress = document.getElementById("shipping-address");
            if (select.value === "משלוח") {
                var city = document.getElementById("city").value || "";
                var street = document.getElementById("street").value || "";
                var apartment = document.getElementById("apartment-number").value || "";
                var zip = document.getElementById("zip-code").value || "";
                hiddenAddress.value = `${city}, ${street}, דירה ${apartment}, מיקוד ${zip}`.replace(/, ,/g, ",").trim();
            } else {
                hiddenAddress.value = "";
            }
        }

        function validateForm() {
            var fullName = document.getElementsByName("full-name")[0].value;
            var stickerQuantity = document.getElementsByName("sticker-quantity")[0].value;
            var payboxAmount = document.getElementsByName("paybox-amount")[0].value;
            var shippingPickup = document.getElementById("shipping-pickup").value;
            var paidBy = document.getElementsByName("paid-by")[0].value;
            var phone = document.getElementsByName("phone")[0].value;

            // Check main fields
            if (!fullName || !stickerQuantity || !payboxAmount || !shippingPickup || !paidBy || !phone) {
                alert("אנא מלא את כל השדות החובה");
                return false;
            }

            // If shipping is selected, validate address fields
            if (shippingPickup === "משלוח") {
                var city = document.getElementById("city").value;
                var street = document.getElementById("street").value;
                var apartment = document.getElementById("apartment-number").value;
                var zip = document.getElementById("zip-code").value;
                if (!city || !street || !apartment || !zip) {
                    alert("אנא מלא את כל פרטי הכתובת עבור משלוח");
                    return false;
                }
            }

            // Combine address before submitting
            combineAddress();
            return true;
        }
    </script>
</body>
</html>
